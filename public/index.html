<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DIGITAL ECHO | EXECUTIVES</title>
    <link rel="stylesheet" href="./dist/output.css" />
    <link rel="icon" href="data:," />
    <style>
      @keyframes pulse-green {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .animate-pulse-slow {
        animation: pulse-green 2s infinite;
      }
      .terminal-glow {
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.15);
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <section class="py-20 px-6 max-w-4xl mx-auto text-center">
      <h1 class="text-4xl font-black tracking-tighter mb-4 uppercase">
        Digital Echo <span class="text-green-600">HQ</span>
      </h1>
      <p
        class="text-gray-500 mb-10 font-mono text-sm uppercase tracking-widest"
      >
        Autonomous Business Architect & AI Workforce
      </p>

      <div
        class="bg-white p-8 rounded-xl border border-gray-200 shadow-sm text-left"
      >
        <label
          class="block text-xs font-bold uppercase tracking-widest mb-3 text-gray-400"
          >Business Intelligence Intake</label
        >
        <textarea
          id="businessContext"
          class="w-full p-4 border border-gray-200 rounded-lg mb-4 h-40 font-mono text-sm focus:ring-2 focus:ring-black outline-none transition"
          placeholder="Enter business data, travel packages, or operational details..."
        ></textarea>

        <button
          id="btn"
          onclick="runAnalysis()"
          class="w-full bg-black text-white font-bold py-4 rounded-lg hover:bg-gray-800 transition uppercase tracking-widest text-sm"
        >
          Deploy Analysis
        </button>
      </div>

      <div id="loading" class="hidden mt-10">
        <div class="flex flex-col items-center space-y-4">
          <div
            class="animate-spin rounded-full h-10 w-10 border-b-2 border-green-600"
          ></div>
          <p
            id="status-text"
            class="text-xs font-mono text-green-600 uppercase tracking-widest animate-pulse-slow"
          >
            Establishing Secure Connection...
          </p>
        </div>
      </div>

      <div id="result-container" class="mt-12 hidden text-left">
        <details
          class="mb-4 bg-gray-900 rounded-lg border border-green-900/30 overflow-hidden"
        >
          <summary
            class="cursor-pointer p-4 text-[10px] font-mono text-green-500/70 hover:bg-gray-800 transition uppercase tracking-widest"
          >
            [SYSTEM] RAW_SOURCE_DATA (Click to View)
          </summary>
          <div
            id="user-input-mirror"
            class="p-6 text-xs font-mono text-gray-500 border-t border-green-900/20 bg-black leading-relaxed"
          ></div>
        </details>

        <div
          class="bg-black rounded-lg border border-green-500/30 overflow-hidden terminal-glow"
        >
          <div
            class="bg-gray-900 px-4 py-3 border-b border-green-500/20 flex items-center justify-between"
          >
            <div class="flex space-x-2">
              <div class="w-2.5 h-2.5 rounded-full bg-red-500/40"></div>
              <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/40"></div>
              <div class="w-2.5 h-2.5 rounded-full bg-green-500/40"></div>
            </div>
            <span
              class="text-[9px] font-mono text-green-500/50 tracking-[0.3em] uppercase"
              >Executive Output Terminal</span
            >
          </div>
          <div
            id="result"
            class="p-8 font-mono text-green-400 text-sm leading-7 min-h-[400px]"
          ></div>
        </div>
      </div>
    </section>

    <script>
      async function runAnalysis() {
        const inputField = document.getElementById("businessContext");
        const resultContainer = document.getElementById("result-container");
        const resultDiv = document.getElementById("result");
        const userInputMirror = document.getElementById("user-input-mirror");
        const btn = document.getElementById("btn");
        const loadingDiv = document.getElementById("loading");
        const statusText = document.getElementById("status-text");

        if (!inputField.value.trim())
          return alert("PROTOCOL ERROR: Data input required.");

        // 1. UI STATE: LOADING
        btn.disabled = true;
        btn.innerText = "EXECUTING...";
        loadingDiv.classList.remove("hidden");
        resultContainer.classList.add("hidden");
        userInputMirror.innerText = inputField.value;

        // STATUS ROTATION
        const msgs = [
          "Mapping Revenue Leakage...",
          "Architecting Custom Dashboards...",
          "Simulating AI Workforce...",
          "Finalizing Executive Offer...",
        ];
        let mIdx = 0;
        const msgInterval = setInterval(() => {
          statusText.innerText = msgs[mIdx++ % msgs.length];
        }, 2000);

        try {
          const response = await fetch("/api/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ context: inputField.value }),
          });

          const data = await response.json();

          // 2. UI STATE: SUCCESS
          clearInterval(msgInterval);
          loadingDiv.classList.add("hidden");
          resultContainer.classList.remove("hidden");

          // TYPING EFFECT
          typeEffect(resultDiv, data.analysis);
        } catch (error) {
          console.error(error);
          loadingDiv.classList.add("hidden");
          alert("SYSTEM FAILURE: Check Console.");
        } finally {
          btn.disabled = false;
          btn.innerText = "Deploy Analysis";
        }
      }

      function typeEffect(element, text) {
        element.innerHTML = "";
        let i = 0;
        const formatted = text.replace(/\n/g, "<br>");
        const timer = setInterval(() => {
          if (i < formatted.length) {
            if (formatted.substring(i, i + 4) === "<br>") {
              element.innerHTML += "<br>";
              i += 4;
            } else {
              element.innerHTML += formatted.charAt(i);
              i++;
            }
          } else {
            clearInterval(timer);
          }
        }, 2); // Fast typing for professionalism
      }
    </script>
  </body>
</html>
