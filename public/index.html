<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DIGITAL ECHO | EXECUTIVES</title>
    <link rel="stylesheet" href="./dist/output.css" />
    <link rel="icon" href="data:," />
    <style>
      @keyframes pulse-green {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .animate-pulse-slow {
        animation: pulse-green 2s infinite;
      }
      .terminal-glow {
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.15);
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900 font-sans">
    <section class="py-20 px-6 max-w-4xl mx-auto text-center">
      <h1 class="text-4xl font-black tracking-tighter mb-4 uppercase">
        Digital Echo <span class="text-green-600">HQ</span>
      </h1>
      <p
        class="text-gray-500 mb-10 font-mono text-sm uppercase tracking-widest"
      >
        Autonomous Business Architect & AI Workforce
      </p>

      <div
        class="bg-white p-8 rounded-xl border border-gray-200 shadow-sm text-left"
      >
        <label
          class="block text-xs font-bold uppercase tracking-widest mb-3 text-gray-400"
          >Business Intelligence Intake</label
        >
        <textarea
          id="businessContext"
          aria-label="Business Context Input"
          class="w-full p-4 border border-gray-200 rounded-lg mb-4 h-40 font-mono text-sm focus:ring-2 focus:ring-black outline-none transition"
          placeholder="Enter business data, travel packages, or operational details..."
        ></textarea>

        <button
          id="btn"
          aria-label="Deploy Analysis"
          onclick="runAnalysis()"
          class="w-full bg-black text-white font-bold py-4 rounded-lg hover:bg-gray-800 transition uppercase tracking-widest text-sm"
        >
          Deploy Analysis
        </button>
      </div>

      <div id="loading" class="hidden mt-10">
        <div class="flex flex-col items-center space-y-4">
          <div
            class="animate-spin rounded-full h-10 w-10 border-b-2 border-green-600"
          ></div>
          <p
            id="status-text"
            class="text-xs font-mono text-green-600 uppercase tracking-widest animate-pulse-slow"
          >
            Establishing Secure Connection...
          </p>
        </div>
      </div>

      <div id="result-container" class="mt-10 hidden text-left">
        <div
          class="mb-4 bg-gray-900 rounded border border-green-900/30 overflow-hidden"
        >
          <button
            onclick="toggleInput()"
            class="w-full flex justify-between items-center p-3 text-[10px] font-mono text-green-500 hover:bg-gray-800 transition uppercase"
          >
            <span>[LOG] SOURCE_INTEL_RETAINED</span>
            <span id="toggle-icon">[ - ]</span>
          </button>
          <div
            id="user-input-mirror"
            class="p-4 text-xs font-mono text-gray-400 border-t border-green-900/20 bg-black"
          ></div>
        </div>

        <div
          class="bg-black rounded-lg border border-green-500/50 shadow-2xl overflow-hidden terminal-glow"
        >
          <div
            class="bg-gray-900 px-4 py-2 border-b border-green-500/30 flex items-center justify-between"
          >
            <span
              class="text-[10px] font-mono text-green-500 uppercase tracking-widest"
              >Digital Echo Intelligence</span
            >
            <div class="flex space-x-2">
              <button
                onclick="copyResult()"
                class="text-[9px] bg-green-900/30 text-green-500 border border-green-900/50 px-2 py-1 rounded hover:bg-green-500 hover:text-black transition"
              >
                COPY_REPORT
              </button>
            </div>
          </div>
          <div
            id="result"
            class="p-8 font-mono text-green-400 text-sm leading-relaxed min-h-[400px]"
          ></div>
        </div>
      </div>

      <div
        id="action-section"
        class="mt-6 flex flex-col space-y-4 animate-bounce"
      >
        <p
          class="text-[10px] font-mono text-gray-400 text-center uppercase tracking-[0.2em]"
        >
          Ready to eliminate these leaks?
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="https://wa.me/+959259118807"
            target="_blank"
            class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded text-xs font-mono uppercase tracking-widest text-center transition shadow-[0_0_15px_rgba(22,163,74,0.4)]"
          >
            Direct_WhatsApp_Access
          </a>
          <a
            href="https://t.me/Luffy_Morningstar"
            target="_blank"
            class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded text-xs font-mono uppercase tracking-widest text-center transition shadow-[0_0_15px_rgba(37,99,235,0.4)]"
          >
            Secure_Telegram_Line
          </a>
        </div>
      </div>
    </section>

    <script>
      function toggleInput() {
        const mirror = document.getElementById("user-input-mirror");
        const icon = document.getElementById("toggle-icon");
        mirror.classList.toggle("hidden");
        icon.innerText = mirror.classList.contains("hidden")
          ? "[ + ]"
          : "[ - ]";
      }

      function copyResult() {
        const text = document.getElementById("result").innerText;
        navigator.clipboard.writeText(text);
        alert("Report Copied to Cipher-Board.");
      }

      async function runAnalysis() {
        const inputField = document.getElementById("businessContext");
        const resultContainer = document.getElementById("result-container");
        const resultDiv = document.getElementById("result");
        const userInputMirror = document.getElementById("user-input-mirror");
        const btn = document.getElementById("btn");
        const loadingDiv = document.getElementById("loading");

        if (!inputField.value.trim()) return;

        const savedInput = inputField.value; // Save it to show in mirror
        btn.disabled = true;
        loadingDiv.classList.remove("hidden");
        resultContainer.classList.add("hidden");
        userInputMirror.innerText = savedInput;

        try {
          const response = await fetch("/api/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ context: savedInput }),
          });

          const data = await response.json();

          // SUCCESS: UI Transitions
          loadingDiv.classList.add("hidden");
          resultContainer.classList.remove("hidden");
          inputField.value = ""; // CLEAR INPUT BOX (The Clean Move)

          typeEffect(resultDiv, data.analysis);
        } catch (error) {
          loadingDiv.classList.add("hidden");
          console.error(error);
        } finally {
          btn.disabled = false;
        }
      }

      function typeEffect(element, text) {
        element.innerHTML = "";
        let i = 0;
        const formatted = text.replace(/\n/g, "<br>");
        const timer = setInterval(() => {
          if (i < formatted.length) {
            if (formatted.substring(i, i + 4) === "<br>") {
              element.innerHTML += "<br>";
              i += 4;
            } else {
              element.innerHTML += formatted.charAt(i);
              i++;
            }
          } else {
            clearInterval(timer);
          }
        }, 2); // Fast typing for professionalism
      }
    </script>
  </body>
</html>
